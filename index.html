<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
   <script>
    class BbAuthWrapper {
        constructor(){
            if (libcurl_loaded==false){throw new Error("LibCurl not yet loaded!");}
            this.username=localStorage.getItem("username");
            this.tt="";
            this.asvc="";
            this.gcode=localStorage.getItem("code");;
            this.bearer="";
            this.state=localStorage.getItem("state");
            this.asis=localStorage.getItem("asis");
        }
        async get_bearer(){
                const target="https://sts-sso.myschoolapp.com/oauth2/token"
                console.log(this.asvc)
                let resp=await libcurl.fetch(target,{method: 'POST',headers: {"cookie": this.asvc, "x-csrf": "token_needed","Content-Type": "application/json"},body: '{"environment_id":"p-9A4jO0o5LESTJyyg7MVsCA","permission_scope":"bem-legacy"}'});
                console.log(resp);
                let resp_json=await resp.json();
                let bearer=resp_json['access_token'];
                this.bearer=bearer;
                localStorage.setItem("bearer",bearer);
                return bearer;
        }
    }
   </script> 
</body>